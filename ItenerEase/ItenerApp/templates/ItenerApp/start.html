<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Itinerary Planner</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        
        .chat-container {
            display: flex;
            flex-direction: column;
            width: 90%;
            max-width: 1200px;
            height: 90vh;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            overflow-y: auto;
        }
        
        .message {
            border-radius: 20px;
            padding: 10px;
            margin: 10px 0;
            max-width: 70%;
        }
        
        #submit-dates-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #submit-dates-button:hover {
            background-color: #0056b3;
        }
        
        .bot-message {
            background-color: #f1f1f1;
            align-self: flex-start;
        }
        
        .user-message {
            background-color: #007bff;
            color: white;
            align-self: flex-end;
        }
        
        form {
            display: flex;
            flex-direction: column;
            margin-top: 20px;
        }
        
        form input, form button {
            margin: 10px 0;
            cursor: pointer;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        
        form select {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            background-color: white;
            font-size: 16px;
            width: 100%;
            appearance: none;
        }
        
        form select:focus {
            outline: none;
            border-color: #007bff;
        }
        
        .add-destination-button {
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 18px;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            margin-left: 10px;
            margin-bottom: 10px;
        }
        
        .destination-group {
            display: flex;
            align-items: center;
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        /* Container for the entire destination section */
        .destination-container {
            margin-bottom: 20px;
        }
        
        /* Section for each type of places */
        .places-section {
            margin-bottom: 20px;
        }
        
        /* Title for each destination */
        .destination-title {
            font-size: 1.8em;
            font-weight: bold;
            margin: 20px 0;
            text-align: center;
        }
        
        /* Title for each section */
        .places-section h3 {
            font-size: 1.2em;
            font-weight: bold;
            margin: 10px 0;
            text-align: center;
        }
        
        /* Horizontal rule */
        .places-section hr {
            border: 1px solid #ddd;
            margin: 20px 0;
        }
        
        /* Container for places */
        .grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr); /* 3 columns */
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .grid-item {
            flex: 1 1 auto;
            border: 1px solid #ccc;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            transition: transform 0.3s ease;
        }
        
        .grid-item img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Ensures the image covers the entire container */
            aspect-ratio: 1 / 1; /* Forces the aspect ratio to be 1:1 (square) */
        }
        
        .grid-item:hover {
            transform: scale(1.03);
        }
        
        /* Ensure button color changes */
        .grid-item button {
            background-color: #f44336; /* Default color */
            position: absolute;
            left: 25px;
            bottom: 0px;
            border: none;
            color: white;
            padding: 10px;
            cursor: pointer;
            border-radius: 5px;
            width: 80%; /* Ensure button does not cover the place name */
        }
        
        .grid-item button.interested {
            background-color: #4CAF50; /* Green when interested */  
        }
        
        .grid-item button:hover {
            transform: scale(1.05);
        }
        
        .interest-button {
            transition: transform 0.3s ease;
        }

        .interest-button:hover {
            transition: transform 0.3s ease,
        }
        
        .place-box {
            position: relative;
            padding-bottom: 40px; /* Space for the button */
            text-align: center;
        }

        .place-box img {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Ensures the image covers the entire container */
            aspect-ratio: 1 / 1; /* Forces the aspect ratio to be 1:1 (square) */
        }
        
        .place-box p {
            font-size: 16px;
            margin: 5px 0;
            font-weight: bold;
            position: relative;
        }
        
        /* Button container for finalize and default message buttons */
        .button-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .button-container button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        #finalize-button {
            background-color: #4CAF50;
            color: white;
        }
        
        #finalize-button:hover {
            background-color: #45a049;
        }
        
        #default-message-button {
            background-color: #f44336;
            color: white;
        }
        
        #default-message-button:hover {
            background-color: #d32f2f;
        }     

        .stay-options-container {
            display: block;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            margin-bottom: 20px;
        }
        
        .stay-option-button {
            display: inline-block;
            margin-right: 10px;
            margin-bottom: 10px;
            background-color: #007BFF;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .stay-option-button:hover {
            background-color: #0056b3;
        }
        
        .stay-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
        }
        
        .stay-box {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            width: 250px; /* Adjust width as needed */
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            text-align: center;
            padding: 10px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .stay-box img {
            width: 100%;
            height: auto;
        }
        
        .stay-box p {
            margin: 10px 0;
        }
        
        .choose-button {
            background-color: #007BFF;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .choose-button:hover {
            background-color: #0056b3;
        }
        
        .stay-box:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
        
        .sort-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .sort-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            margin-bottom: 10px;
        }
        .sort-buttons button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .sort-buttons button:hover {
            background-color: #0056b3;
        }

        .destination-heading {
            font-size: 18px;
            margin-bottom: 10px;
        }

        hr {
            border: 1px solid #ccc;
            margin: 20px 0;
        }
        
        /* Style for the chat bubble */
        .message.left-bubble {
            background-color:  #f1f1f1;; /* Change background color to white */
            color: black; /* Change text color to black */
            float: left; /* Align bubble to the left */
            margin: 10px 0; /* Add some margin */
            padding: 10px;
            border-radius: 10px; /* Add rounded corners */
            width: 500px;
            max-width: 80%; /* Limit the width */
            display: flex; /* Flexbox for aligning image and details */
            align-items: center;
        }

        /* Style for the image inside the bubble */
        .bubble-image {
            width: 200px; /* Adjust the width as needed */
            height: 200px; /* Adjust the height as needed */
            margin-right: 10px; /* Add some space between image and details */
            border-radius: 5px; /* Add rounded corners to the image */
        }

        /* Style for the details inside the bubble */
        .bubble-details {
            flex-grow: 1;
        }

        /* Container for the grid of stay options */
        .stay-options-grid {
            display: grid; /* Use CSS Grid */
            grid-template-columns: repeat(3, 1fr); /* Create 3 equal-width columns */
            gap: 15px; /* Space between grid items */
            margin-top: 20px; /* Space above the grid */
            justify-items: center; /* Center the items in their grid cells */
        }

        /* Each option box inside the grid */
        .option-box {
            width: 90%; /* Adjust the width of each box */
            max-width: 280px; /* Ensure the box doesn't get too wide */
            border: 2px solid #ccc; /* Border color */
            border-radius: 10px; /* Rounded corners */
            padding: 15px; /* Padding inside the box */
            text-align: center; /* Center align content */
            transition: transform 0.3s ease, box-shadow 0.3s ease; /* Smooth transition for hover effect */
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
            background-color: #f9f9f9; /* Background color of the box */
        }

        /* Hover effect for the option box */
        .option-box:hover {
            transform: translateY(-5px); /* Slightly move the box up on hover */
            box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.2); /* Enhance the shadow on hover */
            background-color: #fff; /* Change background color on hover */
        }

        /* Style for the image inside the option box */
        .option-image {
            width: 100%; /* Make sure the image fits inside the box */
            height: auto; /* Maintain aspect ratio */
            border-radius: 5px; /* Rounded corners for the image */
            margin-bottom: 10px; /* Space between image and text */
        }

        /* Style for the option name */
        .option-box h4 {
            margin: 10px 0; /* Space above and below the name */
            font-size: 1.2em; /* Slightly larger font size */
            color: #333; /* Text color */
        }

        /* Style for the price */
        .option-box p {
            margin: 5px 0 15px; /* Space above the price and below the button */
            font-size: 1em; /* Normal font size */
            color: #777; /* Subtle text color */
        }

        /* Style for the "Choose" button */
        .choose-button {
            padding: 10px 20px; /* Padding for the button */
            border: none; /* Remove default border */
            border-radius: 5px; /* Rounded corners */
            background-color: #007bff; /* Button background color */
            color: #fff; /* Button text color */
            cursor: pointer; /* Pointer cursor on hover */
            transition: background-color 0.3s ease; /* Smooth transition for background color */
        }

        /* Hover effect for the "Choose" button */
        .choose-button:hover {
            background-color: #0056b3; /* Darker blue on hover */
        }
    </style>
</head>
<body>
    <div class="chat-container" id="chat-container">
        <!-- Messages and form fields will be injected here dynamically -->
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const chatContainer = document.getElementById('chat-container');
            let storedDestinations = [];
            let storedVacationType = '';
        
            // Sequentially show messages and form
            setTimeout(function() {
                const hiMessage = document.createElement('div');
                hiMessage.className = 'message bot-message fade-in';
                hiMessage.textContent = 'Hi';
                chatContainer.appendChild(hiMessage);
            }, 500);
        
            setTimeout(function() {
                const introMessage = document.createElement('div');
                introMessage.className = 'message bot-message fade-in';
                introMessage.textContent = "You're looking for an itinerary, I see. How many people are going? What are the dates, starting location, and destination?";
                chatContainer.appendChild(introMessage);
            }, 2000);
        
            setTimeout(function() {
                const formHTML = `
                    <form id="itinerary-form" class="fade-in">
                        <label for="num-people">Number of People:</label>
                        <input type="number" id="num-people" name="num_people" required>
        
                        <label for="start-location">Starting Location:</label>
                        <input type="text" id="start-location" name="start_location" required>
        
                        <label for="destination">Destination(s):</label>
                        <div id="destinations-container">
                            <div class="destination-group">
                                <input type="text" class="destination-field" name="destinations[]" placeholder="Enter a destination" required>
                                <button type="button" class="add-destination-button" id="add-destination">+</button>
                            </div>
                        </div>
        
                        <label for="vacation-type">Where would you like to go primarily during your trip?</label>
                        <select id="vacation-type" name="vacation_type" required>
                            <option value="pilgrimage">Pilgrimage</option>
                            <option value="casual">Casual</option>
                            <option value="adventure">Adventure</option>
                        </select>
        
                        <button type="submit">Confirm</button>
                    </form>
                `;
        
                const formContainer = document.createElement('div');
                formContainer.innerHTML = formHTML;
                chatContainer.appendChild(formContainer);
        
                // Add event listener for the "+" button
                document.getElementById('add-destination').addEventListener('click', function() {
                    const newDestinationGroup = document.createElement('div');
                    newDestinationGroup.className = 'destination-group';
        
                    const newDestination = document.createElement('input');
                    newDestination.type = 'text';
                    newDestination.className = 'destination-field';
                    newDestination.name = 'destinations[]';
                    newDestination.placeholder = 'Enter a destination';
                    newDestination.required = true;
        
                    const newAddButton = document.createElement('button');
                    newAddButton.type = 'button';
                    newAddButton.className = 'add-destination-button';
                    newAddButton.textContent = '+';
        
                    newDestinationGroup.appendChild(newDestination);
                    newDestinationGroup.appendChild(newAddButton);
                    document.getElementById('destinations-container').appendChild(newDestinationGroup);
        
                    // Recursively add event listener to the new "+" button
                    newAddButton.addEventListener('click', arguments.callee);
                });
            }, 3500); // Adding delay to simulate the sequential flow
        
            // Handle form submission via AJAX
            document.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const form = e.target;  // Get the form that was submitted
                const formId = form.getAttribute('id');  // Get the form's ID
        
                if (formId === 'itinerary-form') {
                    handleItineraryFormSubmit(form);
                } else if (formId === 'date-form') {
                    handleDateFormSubmit(form);
                }
            });
        
            function handleItineraryFormSubmit(form) {
                const confirmButton = form.querySelector('button[type="submit"]');
                
                // Collect destinations as an array
                const destinationFields = document.querySelectorAll('.destination-field');
                storedDestinations = Array.from(destinationFields).map(field => field.value);
                storedVacationType = form.querySelector('#vacation-type').value;
                
                // Create form data
                const formData = new FormData(form);
                formData.append('destinations', JSON.stringify(storedDestinations)); // Send destinations as JSON array
                
                // Send data via AJAX
                fetch('/submit-itinerary/', {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken'),
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const botMessage = document.createElement('div');
                        botMessage.className = 'message bot-message fade-in';
                        botMessage.textContent = `Okay perfect! You are ${data.num_people} people going from ${data.start_location} to ${storedDestinations.join(', ')} on a ${storedVacationType} trip.`;
                        chatContainer.appendChild(botMessage);
                        chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll to the bottom
            
                        // Disable form to prevent resubmission
                        disableForm(form);
            
                        // After "Perfect!" message, ask for travel dates
                        setTimeout(function() {
                            askForTravelDates();
                        }, 2000); // Delay after "Perfect" message
                    }
                });
                
                // Disable the confirm button to prevent multiple clicks
                confirmButton.disabled = true;
                confirmButton.style.cursor = 'not-allowed';
            }
        
            function handleDateFormSubmit(form) {
                const dateFormData = new FormData(form);
                
                // Send data via AJAX
                fetch('/submit-dates/', {
                    method: 'POST',
                    body: dateFormData,
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken'),
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const botMessage = document.createElement('div');
                        botMessage.className = 'message bot-message fade-in';
                        botMessage.textContent = "Thank you! We have received your travel dates.";
                        chatContainer.appendChild(botMessage);
                        chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll to the bottom
            
                        // Ask for places of interest after receiving dates
                        askForPlacesOfInterest(storedDestinations, storedVacationType);
            
                        // Disable form to prevent resubmission
                        disableForm(form);
                    }
                });
                
                // Disable the submit button to prevent multiple clicks
                form.querySelector('button[type="submit"]').disabled = true;
            }            
        
            function askForTravelDates(destinations, vacationType) {
                const travelDateMessage = document.createElement('div');
                travelDateMessage.className = 'message bot-message fade-in';
                travelDateMessage.textContent = "Great! Please provide your travel dates.";
                chatContainer.appendChild(travelDateMessage);
        
                const dateFormHTML = `
                    <form id="date-form" class="fade-in">
                        <label for="from-date">From Date:</label>
                        <input type="date" id="from-date" name="from_date" required>
                        
                        <label for="to-date">To Date:</label>
                        <input type="date" id="to-date" name="to_date" required>
                        
                        <button type="submit">Submit Dates</button>
                    </form>
                `;
                
                const dateFormContainer = document.createElement('div');
                dateFormContainer.innerHTML = dateFormHTML;
                chatContainer.appendChild(dateFormContainer);
                chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll to the bottom
            }
        
            function disableForm(form) {
                // Disable all form fields to lock them
                const formFields = form.querySelectorAll('input, select, button');
                formFields.forEach(field => {
                    field.disabled = true;
                });
            }
        
            function askForPlacesOfInterest(destinations, vacationType) {
                setTimeout(function() {
                    const interestMessage = document.createElement('div');
                    interestMessage.className = 'message bot-message fade-in';
                    interestMessage.textContent = "Would you like to tell us some places you'd specifically like to visit from your destination(s)?";
                    chatContainer.appendChild(interestMessage);
                    chatContainer.scrollTop = chatContainer.scrollHeight;
            
                    // Display places for each destination   
                    destinations.forEach(destination => {
                        displayPlacesForDestination(destination, vacationType);
                    });
            
                    // Add buttons after grids are displayed
                    const buttonContainer = document.createElement('div');
                    buttonContainer.className = 'button-container';

                    // Create the finalize button
                    const finalizeButton = document.createElement('button');
                    finalizeButton.id = 'finalize-button';
                    finalizeButton.textContent = 'Finalize';
                    finalizeButton.className = 'button finalize-button'; // Add a class for styling
                    finalizeButton.addEventListener('click', finalizeSelection);

                    // Create the "I'm open to anything" button
                    const defaultMessageButton = document.createElement('button');
                    defaultMessageButton.id = 'default-message-button';
                    defaultMessageButton.textContent = "I'm open to anything";
                    defaultMessageButton.className = 'button default-message-button'; // Add a class for styling
                    defaultMessageButton.addEventListener('click', handleDefaultMessage);
            
                    buttonContainer.appendChild(finalizeButton);
                    buttonContainer.appendChild(defaultMessageButton);
                    chatContainer.appendChild(buttonContainer);
                }, 1500); // Adjust the timing as needed
            }        
            
            function handleDefaultMessage() {
                lockButtons();
                const userMessage = document.createElement('div');
                userMessage.className = 'message user-message fade-in';
                userMessage.textContent = "I'm open to anything";
                chatContainer.appendChild(userMessage);
                chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll to the bottom
            
                // Send the default message to the backend
                fetch('/submit-interested-places/', {
                    method: 'POST',
                    body: JSON.stringify({ message: "I'm open to anything" }),
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken'),
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const botMessage = document.createElement('div');
                        botMessage.className = 'message bot-message fade-in';
                        botMessage.textContent = "Okay, let's get this started with!";
                        chatContainer.appendChild(botMessage);
                        chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll to the bottom
            
                        // Simulate delay before showing stay options
                        setTimeout(() => {
                            console.log("Showing stay options...");
                            showStayOptions(); // Show stay options after delay
                        }, 1000); // Adjust delay as needed
                    }
                });
            }            
            
            function createPlaceBox(place) {
                const placeBox = document.createElement('div');
                placeBox.className = 'place-box';
            
                const img = document.createElement('img');
                img.src = place.image || 'https://via.placeholder.com/150'; // Replace with actual image URL
                img.alt = place.name;
                placeBox.appendChild(img);
            
                const name = document.createElement('p');
                name.textContent = place.name;
                placeBox.appendChild(name);
            
                const button = document.createElement('button');
                button.textContent = 'Interested?';
                button.className = 'interest-button';
                button.addEventListener('click', () => handlePlaceSelection(place.name, button));
                placeBox.appendChild(button);
            
                return placeBox;
            }
        
            // Function to get places based on destination and vacation type
            function getPlacesForDestination(destination, vacationType) {
                // Mock data based on destination and vacation type
                const allPlaces= {
                    "Jaipur":
                    [
                    
                            { name: "Govind Devji Temple", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTaXbgjOuhajSRe7iBKH54NFJtY-VRlDy3Z-A&s", type: "pilgrimage" },
                            { name: "Birla Mandir", image: "https://www.trawell.in/admin/images/upload/151648860Jaipur_Birla_Temple_Main.jpg", type: "pilgrimage" },
                            { name: "Moti Dungri Ganesh Temple", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/00/Sri_Moti_Ganesh_Ji_Mandir_Dungri.jpg/1200px-Sri_Moti_Ganesh_Ji_Mandir_Dungri.jpg", type: "pilgrimage" },
                            { name: "Akshardham Temple", image: "https://myholidayhappiness.com/uploads/akshardham-temple-jaipur-3025.jpg", type: "pilgrimage" },
                            { name: "Shila Devi Temple (Amber Fort)", image: "https://images.nativeplanet.com/img/2016/07/amer-fort-entrance-01-1467353170.jpg", type: "pilgrimage" },
                            { name: "Hot Air Balloon Ride over Jaipur", image: "https://www.oyorooms.com/travel-guide/wp-content/uploads/2022/03/Hot-air-balloon-rides-in-Jaipur-an-exhilarating-experience.jpg", type: "adventure" },
                            { name: "Trekking to Nahargarh Fort", image: "https://media1.thrillophilia.com/filestore/7kdxxckc98ndlmp9rd73z6l733g2_IMG_0715.JPG", type: "adventure" },
                            { name: "Ziplining at Neemrana Fort", image: "https://media1.thrillophilia.com/filestore/sq37wnh2lzo7b0nincrp6fyjwnhv_Neemrana.jpg?w=576&h=650", type: "adventure" },
                            { name: "Cycling tours around the city", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSO-nN_5FR5go3AUNk_fQnJs9lkFPykMacVfw&s", type: "adventure" },
                            { name: "Wildlife Safari at Nahargarh Biological Park", image: "https://static.toiimg.com/photo/65320810.cms", type: "adventure" },
                            { name: "Amber Fort light and sound show", image: "https://media-cdn.tripadvisor.com/media/attractions-splice-spp-674x446/0a/66/3e/1f.jpg", type: "casual" },
                            { name: "Hawa Mahal", image: "https://www.holidify.com/images/cmsuploads/compressed/h4_20170822181427.PNG", type: "casual" },
                            { name: "Jantar Mantar", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTnOwAiPvG5V3Gqh5jRLn6GVqS5vXWexjShFA&s", type: "casual" },
                            { name: "Albert Hall Museum", image: "https://jaipurtourism.co.in/images/places-to-visit/header/albert-hall-museum-jaipur-entry-fee-timings-holidays-reviews-header.jpg", type: "casual" },
                            { name: "Shopping at Johari Bazaar", image: "https://yometro.com/images/places/johari-bazaar.jpg", type: "casual" }
                    ],
                    "Ladakh": 
                    [
                            { name: "Hemis Monastery", image: "https://vargiskhan.com/log/wp-content/uploads/2023/05/hemis-monastery-9.jpg", type: "pilgrimage" },
                            { name: "Thiksey Monastery", image: "https://static.toiimg.com/photo/49409286.cms", type: "pilgrimage" },
                            { name: "Shanti Stupa", image: "https://media1.thrillophilia.com/filestore/incr8e1ls7vwnw6hmzee2d76safs_shutterstock_28393609.jpg", type: "pilgrimage" },
                            { name: "Diskit Monastery", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSpwG_xQJV-Art5PSCshP4TH9WWmZ5ufOWnDg&s", type: "pilgrimage" },
                            { name: "Likir Monastery", image: "https://media1.thrillophilia.com/filestore/r5wp3l5tytmvjsy1ys73dy6lvm3s_1488817094_H-L-likir-gompa.jpg?w=400&dpr=2", type: "pilgrimage" },
                            { name: "Trekking in Markha Valley", image: "https://imgcld.yatra.com/ytimages/image/upload/v1517482421/AdvNation/ANN_TRP252/Markha-Valley-Trek_1465363166_3a1FHb.jpg", type: "adventure" },
                            { name: "Motorbiking on Khardung La", image: "https://images.hindustantimes.com/rf/image_size_630x354/HT/p2/2018/07/05/Pictures/_760868a8-806f-11e8-bd7f-aad8d1b78451.JPG", type: "adventure" },
                            { name: "Rafting on Zanskar River", image: "https://aquaterra.in/wp-content/uploads/2019/10/Zanskar-Ladakh-Leh-River-Rafting-28.jpg", type: "adventure" },
                            { name: "Biking to Pangong Lake", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSHzWsFayVmxRAKPgQK-IC3sJVFz-1Od3ir1A&s", type: "adventure" },
                            { name: "Camel Safari in Nubra Valley", image: "https://www.tourmyindia.com/states/ladakh/imagess/camel-adventure.jpg", type: "adventure" },
                            { name: "Explore Leh Market", image: "https://dynamic-media-cdn.tripadvisor.com/media/photo-o/17/53/db/4b/getlstd-property-photo.jpg?w=1200&h=-1&s=1", type: "casual" },
                            { name: "Stok Palace Museum", image: "https://discoverlehladakh.in/wp-content/uploads/2020/11/Stok-Palace-Gompa-Leh.jpg", type: "casual" },
                            { name: "Walk around Magnetic Hill", image: "https://static.toiimg.com/thumb/msid-107033508,width-1280,height-720,resizemode-4/107033508.jpg", type: "casual" },
                            { name: "Enjoy local cuisine at cafes in Leh", image: "https://assets.architecturaldigest.in/photos/6368d7baf85b39e2ca26f432/16:9/w_1615,h_908,c_limit/Zasgyath%20at%20The%20Grand%20Dragon%20comes%20with%20the%20most%20majestic%20view%20of%20the%20Stok%20Kangri%20range.%20.png", type: "casual" },
                            { name: "Tso Moriri Lake", image: "https://media1.thrillophilia.com/filestore/jyl7pmku807wsg7122r8b8jb63jp_1557384428_shutterstock_754201888.jpg?w=400&dpr=2", type: "casual" }
                    ],
                    "Varanasi":
                    [
                            { name: "Kashi Vishwanath Temple", image: "https://images.indianexpress.com/2021/12/29-2.jpg?resize=728,405", type: "pilgrimage" },
                            { name: "Sankat Mochan Hanuman Temple", image: "https://dynamic-media-cdn.tripadvisor.com/media/photo-o/08/b8/f6/91/sankat-mochan-hanuman.jpg?w=1200&h=1200&s=1", type: "pilgrimage" },
                            { name: "Durga Temple", image: "https://static.toiimg.com/photo/35112422.cms", type: "pilgrimage" },
                            { name: "Tulsi Manas Temple", image: "https://www.tourmyindia.com/states/uttarpradesh/images/tulsi-manas-temple-varanasi.jpg", type: "pilgrimage" },
                            { name: "Bharat Mata Mandir", image: "https://travelsetu.com/apps/uploads/new_destinations_photos/destination/2024/01/05/ae4be49d26e5f17fff4472e7b75f2c2b_1000x1000.jpg", type: "pilgrimage" },
                            { name: "Boat rides on River Ganga", image: "https://media.tacdn.com/media/attractions-splice-spp-674x446/07/72/68/de.jpg", type: "adventure" },
                            { name: "Sunrise at Assi Ghat", image: "https://www.myvaranasi.com/wp-content/uploads/2019/06/Assi-Ghat-morning-240x300.jpg", type: "adventure" },
                            { name: "Walking tours of ancient lanes", image: "https://res.klook.com/image/upload/c_fill,w_750,h_560/q_80/w_80,x_15,y_15,g_south_west,l_Klook_water_br_trans_yhcmh3/activities/jgkl0tsjnsxc67rw6xrv.jpg", type: "adventure" },
                            { name: "Trek to Chunar Fort", image: "https://static.toiimg.com/photo/35113094.cms", type: "adventure" },
                            { name: "Exploring Sarnath Archaeological Site", image: "https://static.toiimg.com/photo/68814312.cms", type: "adventure" },
                            { name: "Assi Ghat evening Aarti", image: "https://kashiyatra.in/wp-content/uploads/2023/10/assi-ghat-ganga-aarti.jpeg", type: "casual" },
                            { name: "Ramnagar Fort", image: "https://upload.wikimedia.org/wikipedia/commons/8/89/Entrance_area_of_Ramnagar_Fort.jpg", type: "casual" },
                            { name: "Banaras Hindu University (BHU) campus walk", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTBfGFWmJlm0HoCMLfb2QwzmBexs5yhmpMgkA&s", type: "casual" },
                            { name: "Varanasi Silk Market", image: "https://i0.wp.com/www.tusktravel.com/blog/wp-content/uploads/2023/03/Gyanvapi-Market-Varanasi.jpg?resize=1200%2C900&ssl=1", type: "casual" },
                            { name: "Weavers’ Village", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSbH884JcfyWbbWTtN1BfcxPjyVUrAZZyDrRw&s", type: "casual" }
                    ],
                    "Rishikesh":
                    [
                            { name: "Triveni Ghat", image: "https://media2.thrillophilia.com/images/photos/000/085/285/original/1584390072_shutterstock_1005613216.jpg?", type: "pilgrimage" },
                            { name: "Parmarth Niketan Ashram", image: "https://wandersky.in/wp-content/uploads/2023/03/parmath-niketan-rishikesh.jpg", type: "pilgrimage" },
                            { name: "Neelkanth Mahadev Temple", image: "https://wandersky.in/wp-content/uploads/2023/08/Neelkanth-Mahadev-Temple-Rishikesh.jpg", type: "pilgrimage" },
                            { name: "Bharat Mandir", image: "https://dynamic-media-cdn.tripadvisor.com/media/photo-o/0c/46/21/57/bongblogger-shri-bharat.jpg?w=1200&h=-1&s=1", type: "pilgrimage" },
                            { name: "Gita Bhavan", image: "https://rishikesh.app/te/_thumb/attractions/geeta-bhavan-banner.jpg", type: "pilgrimage" },
                            { name: "White Water Rafting", image: "https://ataliganga.com/wp-content/uploads/2022/09/About-02.jpg", type: "adventure" },
                            { name: "Bungee Jumping", image: "https://www.seawatersports.com/img/newimage/activies/slide/bungee-jumping-in-delhi-a-girl-bungee-jumping.jpeg", type: "adventure" },
                            { name: "Cliff Jumping", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSXLNUlxA-WO4bY9LiqOz-lyF1vLAR5s7B75w&s", type: "adventure" },
                            { name: "Kayaking on the Ganges", image: "https://rishikesh.app/_vercel/image?url=%2Fte%2Fevents%2Fganga-kayak-fest.jpg&w=1280&q=100", type: "adventure" },
                            { name: "Trek to Neer Garh Waterfall", image: "https://rishikeshdaytour.com/blog/wp-content/uploads/2019/10/Neer-Waterfalls-in-Rishikesh-Uttarakhand.jpg", type: "adventure" },
                            { name: "Beatles Ashram", image: "https://www.junglesafarirajajinationalpark.com/assets/images/beatles-ashram-in-rishikesh.jpg", type: "casual" },
                            { name: "Laxman Jhula Bridge", image: "https://uttarakhandtriptrek.com/wp-content/uploads/2019/02/Ram-Jhula-Rishikesh-Uttarakhand.jpg", type: "casual" },
                            { name: "Café hopping along the Ganges", image: "https://www.myyellowplate.com/wp-content/uploads/2021/03/Shanti-Shanti-Cafe-in-Rishikesh.png", type: "casual" },
                            { name: "Rishikesh Market", image: "https://res.cloudinary.com/purnesh/image/upload/w_540,f_auto,q_auto:eco,c_limit/lakshmanjhulamarket-fotor.jpg", type: "casual" },
                            { name: "Shivpuri", image: "https://r1imghtlak.ibcdn.com/e8712c86931211ec952d0a58a9feac02.jpeg?downsize=634:357", type: "casual" }
                    ],
                    "Udaipur":
                    [
                            { name: "Jagdish Temple", image: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/a1/JagdishTemple-Udaipur-Rajasthan_JM34.jpg/1200px-JagdishTemple-Udaipur-Rajasthan_JM34.jpg", type: "pilgrimage" },
                            { name: "Eklingji Temple", image: "https://dynamic-media-cdn.tripadvisor.com/media/photo-o/09/d4/5c/be/eklingji-temple.jpg?w=1200&h=1200&s=1", type: "pilgrimage" },
                            { name: "Nathdwara Temple", image: "https://www.rajasthandirect.com/wp-content/uploads/2012/11/Shree-Nathji-Temple-Nathdwara-Udaipur.jpg", type: "pilgrimage" },
                            { name: "Neemach Mata Temple", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQHtiDOnpViE8WErMNug2QVdyBJ0uqtdaPVsw&s", type: "pilgrimage" },
                            { name: "Karni Mata Temple", image: "https://www.abhibus.com/blog/wp-content/uploads/2023/12/Karni-Mata-Temple-Udaipur-History-Timings-How-to-Reach.jpg", type: "pilgrimage" },
                            { name: "Trekking to Sajjangarh (Monsoon Palace)", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTCVAcOroRX82HTlNxvuEEO5recQYhv5JU_Jg&s", type: "adventure" },
                            { name: "Boating at Fateh Sagar Lake", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTcjtwe9_k5r2BBv_Q5RtK3qMvKrB0vZLsnBg&s", type: "adventure" },
                            { name: "Ziplining at Kumbhalgarh Fort", image: "https://www.adventurush.com/wp-content/uploads/2022/08/Copy-of-Copy-of-DSC_7495.jpg", type: "adventurous places" },
                            { name: "Cycling around Udaipur’s countryside", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTy8LWEZmy6gpihjE8esjc_a1kgkbCsWUu9BQ&s", type: "adventure" },
                            { name: "Camel safari around the Aravalli hills", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSFaU5W5UPBLNOhrpfSA8eJmqm76oj0wayVig&s", type: "adventure" },
                            { name: "City Palace", image: "https://map.sahapedia.org/admin/assets/images/2021033013400727799_Banner.jpg?__imr__=bannerMuseum", type: "casual" },
                            { name: "Lake Pichola boat ride", image: "https://dynamic-media-cdn.tripadvisor.com/media/photo-o/26/33/75/c5/caption.jpg?w=1200&h=-1&s=1", type: "casual" },
                            { name: "Saheliyon Ki Bari garden", image: "https://udaipurdosti.com/wp-content/uploads/2023/04/Saheliyon-ki-Bari-UDAIPUR-1024x560.webp", type: "casual" },
                            { name: "Jag Mandir Palace", image: "https://udaipurblog.com/wp-content/uploads/2018/03/fi.jpg", type: "casual" },
                            { name: "Shilpgram Arts & Crafts Village", image: "https://i0.wp.com/theudaipurstore.com/wp-content/uploads/2021/08/Shilpgram-3.jpg?fit=869%2C489&ssl=1", type: "casual" }
                    ],
                    "Amritsar":
                    [
                            { name: "Golden Temple (Harmandir Sahib)", image: "https://www.holidify.com/images/cmsuploads/compressed/shutterstock_479585620_20191024174904_20200407155734.jpg", type: "pilgrimage" },
                            { name: "Durgiana Temple", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQOopcU85liykGyVOhaODcp8s8hDlRze225mA&s", type: "pilgrimage" },
                            { name: "Tarn Taran Sahib", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTCRq3WfLXtHhicF02K3FsGacqyqf6RPGxRJw&s", type: "pilgrimage" },
                            { name: "Ram Tirath Temple", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTHv-_qD7NFyK38QwYwSmu9XdamAmep7lFlnw&s", type: "pilgrimage" },
                            { name: "Akal Takht", image: "https://c8.alamy.com/comp/D5KCN1/the-akal-takht-amritsar-india-D5KCN1.jpg", type: "pilgrimage" },
                            { name: "Walking tour of the Old City", image: "https://i0.wp.com/www.tusktravel.com/blog/wp-content/uploads/2023/04/amritsar-amritsar-heritage-walk-10-min.jpg?fit=1920%2C1280&ssl=1", type: "adventure" },
                            { name: "Paintball in Amritsar", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSgKBdiysyo_DtIXrbqD08O-Ux39jC_UPfh0Q&s", type: "adventure" },
                            { name: "Amritsar biking tours", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTLxVuoAStmDZIunV4NChPB0sJEWqY6eBoOsg&s", type: "adventure" },
                            { name: "Attari-Wagah Border Ceremony", image: "https://images.squarespace-cdn.com/content/v1/5940f2725016e1c79e469470/1523379170441-PTHPFWDLU6XJFTTKZP30/wagah+border+parade.jpg", type: "adventure" },
                            { name: "Heritage walk", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTEnvev32UGt2qt6Gzw9a4KEYd7eZkDubzTgg&s", type: "adventure" },
                            { name: "Amritsari food street exploration", image: "https://dynamic-media-cdn.tripadvisor.com/media/photo-o/16/9e/a6/26/20190301-140002-largejpg.jpg?w=1000&h=-1&s=1", type: "casual" },
                            { name: "Partition Museum", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSGEjiD8VBHGdmNVGBpqO_m_vE-owqNWgeHMA&s", type: "casual" },
                            { name: "Summer Palace of Maharaja Ranjit Singh", image: "https://upload.wikimedia.org/wikipedia/commons/a/ac/Summer_Palace_of_Maharaja_Ranjit_Singh%2C_Amritsar%2C_Punjab%2CIndia.jpg", type: "casual" },
                            { name: "Shopping at Hall Bazaar", image: "https://cdn.shopify.com/s/files/1/0596/2819/1910/files/peter-chirkov-pntdBK6aGqw-unsplash_480x480.jpg?v=1676734340", type: "casual" },
                            { name: "Evening stroll around Golden Temple Sarovar", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSzHuU7zfuweq47IZ3MgrsSgaYH-a_txt34Zw&s", type: "casual" }
                    ],
                    
                    "Mysore":
                    [
                            { name: "Chamundeshwari Temple", image: "https://lightuptemples.com/wp-content/uploads/2022/11/1-75.jpg", type: "pilgrimage" },
                            { name: "St. Philomena’s Church", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcR87tWVWEMJeYdWJbdmlKJrLE_FWa7BrB1RhQ&s", type: "pilgrimage" },
                            { name: "Sri Nandi Temple", image: "https://mysore.ind.in/wp-content/uploads/2010/11/Nandi-Shrine-at-Night.jpg", type: "pilgrimage" },
                            { name: "Gayatri Temple", image: "https://srigayathridevi.com/img/banner_temple.jpg", type: "pilgrimage" },
                            { name: "Sri Lakshmiramana Swamy Temple", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ_iGnlPl_qVtg4AweYbveDLBIeBhS-MyuQlA&s", type: "pilgrimage" },
                            { name: "Trekking at Chamundi Hill", image: "https://baarchana.wordpress.com/wp-content/uploads/2009/07/img_0922.jpg", type: "adventure" },
                            { name: "Wildlife Safari at Bandipur National Park", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTiN1JATYgcRxe6G68FbOAkpdiXlLeeqh9pYg&s", type: "adventure" },
                            { name: "Cycling around Karanji Lake", image: "https://dynamic-media-cdn.tripadvisor.com/media/photo-o/07/0a/fa/99/mycycle-mysore-cycle.jpg?w=1200&h=1200&s=1", type: "adventure" },
                            { name: "Boating at Ranganathittu Bird Sanctuary", image: "https://jlrexplore.com/wp-content/uploads/2017/06/06-1.jpg", type: "adventure" },
                            { name: "Skydiving at Mysore Airport", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTrOQOCmxhss2sIU1pyV3WaBkoZWMbFyWUtFg&s", type: "adventure" },
                            { name: "Mysore Palace", image: "https://cdn.britannica.com/27/242227-050-48358A10/Mysore-Palace-Mysuru-Karnataka-India.jpg", type: "casual" },
                            { name: "Brindavan Gardens", image: "https://www.makemytrip.com/travel-guide/media/dg_image/mysore/Brindavan-Gardens-Mysore.jpg", type: "casual" },
                            { name: "Mysore Zoo", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRl6JjgZI2oEW1JZrbdMFeVAhkFa3vXXCLzrQ&s", type: "casual" },
                            { name: "Stroll at Devaraja Market", image: "https://dynamic-media-cdn.tripadvisor.com/media/photo-o/28/87/74/0f/caption.jpg?w=300&h=300&s=1", type: "casual" },
                            { name: "Coffee tasting in local cafés", image: "https://content.jdmagicbox.com/comp/mysore/a5/0821px821.x821.230913215703.b7a5/catalogue/wodeyars-coffee-mysore-coffee-shops-j5tj9vqi4b.jpg", type: "casual" }
                    ]
                        
                };
            
                // Log the fetched places
                console.log(`Fetching places for ${destination} (${vacationType})`);
                const places = allPlaces[destination] || [];
            
                // Filter places by vacation type
                const filteredPlaces = places.filter(place => place.type === vacationType);
            
                // Sort places: primary vacation type first, followed by other types
                const otherPlaces = places.filter(place => place.type !== vacationType);
            
                return [...filteredPlaces, ...otherPlaces];
            }            
                       
        
            function displayPlacesForDestination(destination, vacationType) {
                const places = getPlacesForDestination(destination, vacationType);

                const container = document.createElement('div');
                container.innerHTML = `<hr><h2>${destination}</h2>`;

                // Group places by type
                const types = ['pilgrimage', 'casual', 'adventure'];
                types.forEach(type => {
                    const placesOfType = places.filter(place => place.type === type);
                    if (placesOfType.length > 0) {
                        const section = document.createElement('div');
                        section.innerHTML = `<h3>${type.charAt(0).toUpperCase() + type.slice(1)}</h3>`;
                        const grid = document.createElement('div');
                        grid.className = 'grid-container';
                        placesOfType.forEach(place => {
                            // Create a grid-item container
                            const item = document.createElement('div');
                            item.className = 'grid-item';
                        
                            // Create the place-box container
                            const placeBox = document.createElement('div');
                            placeBox.className = 'place-box';
                        
                            // Add image
                            const img = document.createElement('img');
                            img.src = place.image;
                            img.alt = place.name;
                            placeBox.appendChild(img);
                        
                            // Add place name
                            const name = document.createElement('p');
                            name.textContent = place.name;
                            placeBox.appendChild(name);
                        
                            // Create the button
                            const button = document.createElement('button');
                            button.textContent = 'Interested?';
                            button.className = 'interest-button';
                        
                            // Attach event listener to the button
                            button.addEventListener('click', () => handlePlaceSelection(place.name, button));
                        
                            // Append the button to the place-box
                            placeBox.appendChild(button);
                        
                            // Append the place-box to the item (grid-item)
                            item.appendChild(placeBox);
                        
                            // Finally, append the item to the grid
                            grid.appendChild(item);
                        });                        
                        section.appendChild(grid);
                        container.appendChild(section);
                    }
                });

                // Append the container to the chat container or appropriate place
                chatContainer.appendChild(container);
            }            
            
            function updateButtonState(placeName, interested) {
                const buttons = document.querySelectorAll('.grid-item button');
                buttons.forEach(button => {
                    if (button.parentElement.querySelector('p').textContent === placeName) {
                        if (interested) {
                            button.textContent = '✔ Interested';
                            button.style.backgroundColor = '#4CAF50'; // Green
                        } else {
                            button.textContent = 'Interested?';
                            button.style.backgroundColor = '#f44336'; // Red
                        }
                    }
                });
            }            

            function updateFinalizeButtonVisibility() {
                let finalizeButton = document.getElementById('finalize-button');
                if (!finalizeButton) {
                    finalizeButton = document.createElement('button');
                    finalizeButton.id = 'finalize-button';
                    finalizeButton.textContent = 'Finalize';
                    finalizeButton.addEventListener('click', finalizeSelection);
                    chatContainer.appendChild(finalizeButton);
                }
                finalizeButton.style.display = interestedPlaces.length > 0 ? 'block' : 'none';
            }            
            
            function handleFinalizeButtonClick() {
                lockButtons();
                // Add your finalize logic here
            }
            
            function handleDefaultMessageButtonClick() {
                lockButtons();
                // Add your default message logic here
            }

            function lockButtons() {
                // Lock the finalize and "I'm open to anything" buttons
                document.getElementById('finalize-button').disabled = true;
                document.getElementById('default-message-button').disabled = true;
            
                // Lock the interested buttons
                document.querySelectorAll('.place-box button').forEach(button => {
                    button.disabled = true;
                });
            }

            // List to store interested places
            let interestedPlaces = [];
            function handlePlaceSelection(placeName, button) {
                if (button.disabled) return; // Exit if button is disabled

                // Determine the current state of the button
                let isInterested = button.classList.contains('interested');
            
                if (isInterested) {
                    // If interested, remove the place from the list and update the button
                    interestedPlaces = interestedPlaces.filter(place => place !== placeName);
                    button.textContent = 'Interested?';
                    button.style.backgroundColor = '#f44336'; // Red or any other color
                    button.classList.remove('interested');
                } else {
                    // If not interested, add the place to the list and update the button
                    interestedPlaces.push(placeName);
                    button.textContent = '✔ Interested';
                    button.style.backgroundColor = '#4CAF50'; // Green or any other color
                    button.classList.add('interested');
                }
            
                // Update the finalize button visibility
                updateFinalizeButtonVisibility();
            }

            function finalizeSelection() {
                lockButtons();
                if (interestedPlaces.length === 0) {
                    // Handle case where no places are selected
                    const messageBubble = document.createElement('div');
                    messageBubble.className = 'message user-message fade-in';
                    messageBubble.textContent = "I'm open to anything.";
                    chatContainer.appendChild(messageBubble);
                    chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll to bottom
            
                    // Simulate backend response
                    setTimeout(() => {
                        const botMessage = document.createElement('div');
                        botMessage.className = 'message bot-message fade-in';
                        botMessage.textContent = "Okay, let's get this started with!";
                        chatContainer.appendChild(botMessage);
                        chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll to bottom
                    }, 1000);
                    
                    console.log("Showing stay options...");
                    showStayOptions(); // Show stay options after finalizing selection
                }
            
                fetch('/submit-interested-places/', {
                    method: 'POST',
                    body: JSON.stringify({ interestedPlaces }),
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken'),
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const botMessage = document.createElement('div');
                        botMessage.className = 'message bot-message fade-in';
                        botMessage.textContent = "Thank you for finalizing your selections!";
                        chatContainer.appendChild(botMessage);
                        chatContainer.scrollTop = chatContainer.scrollHeight; // Scroll to bottom
                        setTimeout(() => {
                            showStayOptions();
                        }, 1000);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
            }     

            function showStayOptions() {
                // Show the message
                const stayMessage = document.createElement('div');
                stayMessage.className = 'message bot-message fade-in';
                stayMessage.textContent = "Let's decide the stay next.";
                chatContainer.appendChild(stayMessage);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
		        // Create and append stay type buttons
                const stayTypes = ['Hotels', 'Villas', 'Airbnbs'];

                // Create a container for stay details
                const stayDetailsContainer = document.createElement('div');
                stayDetailsContainer.className = 'stay-details-container';

                storedDestinations.forEach(destination => {
                    // Create and append destination heading
                    const destinationContainer = document.createElement('div');
                    destinationContainer.className = 'destination-container';

                    const destinationHeading = document.createElement('h3');
                    destinationHeading.className = 'destination-heading';
                    destinationHeading.textContent = destination;
                    destinationContainer.appendChild(destinationHeading);

                    // Create a container for stay type buttons
                    const stayOptionsContainer = document.createElement('div');
                    stayOptionsContainer.className = 'stay-options-container';

                    // Create and append stay type buttons to stayOptionsContainer
                    stayTypes.forEach(type => {
                        const button = document.createElement('button');
                        button.textContent = type;
                        button.className = 'stay-option-button';
                        button.addEventListener('click', () => toggleStayData(type, destination));
                        stayOptionsContainer.appendChild(button);
                    });

                    // Append stayOptionsContainer to destinationContainer
                    destinationContainer.appendChild(stayOptionsContainer);

                    // Append destinationContainer to chatContainer
                    chatContainer.appendChild(destinationContainer);

                    // Add horizontal rule for separation after destination
                    createDestinationSeparator(destination);
                });

                // Ensure the chat container scrolls to the bottom
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }

            // Create a separator for each destination when adding destinations
            function createDestinationSeparator(destination) {
                const separator = document.createElement('hr');
                separator.className = 'destination-separator';
                separator.setAttribute('data-destination', destination);
                chatContainer.appendChild(separator);
            }
            ///////////////////////////////////////////////////////////////////////////////////////////////////////////////////

            // Example stay data (replace with your actual data)
            const stayData = {
                            "Jaipur": {
                                "Hotels": [
                                    { name: "Royal Palace Hotel", image: "https://via.placeholder.com/150", price: 200 },
                                    { name: "Budget Heritage Hotel", image: "https://via.placeholder.com/150", price: 100 }
                                ],
                                "Villas": [
                                    { name: "City View Villa", image: "https://via.placeholder.com/150", price: 220 },
                                    { name: "Fort Villa", image: "https://via.placeholder.com/150", price: 180 }
                                ],
                                "Airbnbs": [
                                    { name: "Cultural Airbnb", image: "https://via.placeholder.com/150", price: 120 },
                                    { name: "Modern Airbnb", image: "https://via.placeholder.com/150", price: 100 }
                                ]
                            },
                            "Ladakh": {
                                "Hotels": [
                                    { name: "Mountain Retreat Hotel", image: "https://via.placeholder.com/150", price: 250 },
                                    { name: "Budget Guest House", image: "https://via.placeholder.com/150", price: 80 }
                                ],
                                "Villas": [
                                    { name: "Scenic Villa", image: "https://via.placeholder.com/150", price: 300 },
                                    { name: "Lakeside Villa", image: "https://via.placeholder.com/150", price: 200 }
                                ],
                                "Airbnbs": [
                                    { name: "Rustic Airbnb", image: "https://via.placeholder.com/150", price: 140 },
                                    { name: "Mountain Airbnb", image: "https://via.placeholder.com/150", price: 120 }
                                ]
                            },
                            "Varanasi": {
                                "Hotels": [
                                    { name: "Ganges View Hotel", image: "https://via.placeholder.com/150", price: 180 },
                                    { name: "Budget Holy Stay", image: "https://via.placeholder.com/150", price: 90 }
                                ],
                                "Villas": [
                                    { name: "Spiritual Villa", image: "https://via.placeholder.com/150", price: 220 },
                                    { name: "Ghat Side Villa", image: "https://via.placeholder.com/150", price: 180 }
                                ],
                                "Airbnbs": [
                                    { name: "Holy Airbnb", image: "https://via.placeholder.com/150", price: 110 },
                                    { name: "Traditional Airbnb", image: "https://via.placeholder.com/150", price: 100 }
                                ]
                            },
                            "Rishikesh": {
                                "Hotels": [
                                    { name: "Yoga Retreat Hotel", image: "https://via.placeholder.com/150", price: 200 },
                                    { name: "Budget Meditation Stay", image: "https://via.placeholder.com/150", price: 85 }
                                ],
                                "Villas": [
                                    { name: "Riverfront Villa", image: "https://via.placeholder.com/150", price: 230 },
                                    { name: "Mountain View Villa", image: "https://via.placeholder.com/150", price: 150 }
                                ],
                                "Airbnbs": [
                                    { name: "Eco-friendly Airbnb", image: "https://via.placeholder.com/150", price: 120 },
                                    { name: "Rustic Airbnb", image: "https://via.placeholder.com/150", price: 110 }
                                ]
                            },
                            "Udaipur": {
                                "Hotels": [
                                    { name: "Lake Palace Hotel", image: "https://via.placeholder.com/150", price: 250 },
                                    { name: "Budget Lake View Hotel", image: "https://via.placeholder.com/150", price: 95 }
                                ],
                                "Villas": [
                                    { name: "Luxury Villa", image: "https://via.placeholder.com/150", price: 270 },
                                    { name: "Hilltop Villa", image: "https://via.placeholder.com/150", price: 190 }
                                ],
                                "Airbnbs": [
                                    { name: "Palatial Airbnb", image: "https://via.placeholder.com/150", price: 150 },
                                    { name: "Heritage Airbnb", image: "https://via.placeholder.com/150", price: 130 }
                                ]
                            },
                            "Amritsar": {
                                "Hotels": [
                                    { name: "Golden Temple View Hotel", image: "https://via.placeholder.com/150", price: 210 },
                                    { name: "Budget Pilgrim Stay", image: "https://via.placeholder.com/150", price: 85 }
                                ],
                                "Villas": [
                                    { name: "Spiritual Villa", image: "https://via.placeholder.com/150", price: 240 },
                                    { name: "Countryside Villa", image: "https://via.placeholder.com/150", price: 160 }
                                ],
                                "Airbnbs": [
                                    { name: "Pilgrim Airbnb", image: "https://via.placeholder.com/150", price: 120 },
                                    { name: "Modern Airbnb", image: "https://via.placeholder.com/150", price: 100 }
                                ]
                            },
                            "Mysore": {
                                "Hotels": [
                                    { name: "Palace View Hotel", image: "https://via.placeholder.com/150", price: 180 },
                                    { name: "Budget Stay", image: "https://via.placeholder.com/150", price: 70 }
                                ],
                                "Villas": [
                                    { name: "Royal Villa", image: "https://via.placeholder.com/150", price: 210 },
                                    { name: "Nature Villa", image: "https://via.placeholder.com/150", price: 160 }
                                ],
                                "Airbnbs": [
                                    { name: "Heritage Airbnb", image: "https://via.placeholder.com/150", price: 130 },
                                    { name: "Cozy Airbnb", image: "https://via.placeholder.com/150", price: 100 }
                                ]
                            }
                            // Add other destinations here
                        };

            function showStayOptions() {
                    // Show the message
                    const stayMessage = document.createElement('div');
                    stayMessage.className = 'message bot-message fade-in';
                    stayMessage.textContent = "Let's decide the stay next.";
                    chatContainer.appendChild(stayMessage);
                    chatContainer.scrollTop = chatContainer.scrollHeight;

                    const stayTypes = ['Hotels', 'Villas', 'Airbnbs'];

                    storedDestinations.forEach(destination => {
                        const destinationContainer = document.createElement('div');
                        destinationContainer.className = 'destination-container';

                        const destinationHeading = document.createElement('h3');
                        destinationHeading.className = 'destination-heading';
                        destinationHeading.textContent = destination;
                        destinationContainer.appendChild(destinationHeading);

                        const stayOptionsContainer = document.createElement('div');
                        stayOptionsContainer.className = 'stay-options-container';

                        stayTypes.forEach(type => {
                            const button = document.createElement('button');
                            button.textContent = type;
                            button.className = 'stay-option-button';
                            button.addEventListener('click', () => toggleStayData(type, destination));
                            stayOptionsContainer.appendChild(button);
                        });

                        destinationContainer.appendChild(stayOptionsContainer);

                        // Create a container for stay options display
                        const stayDisplayContainer = document.createElement('div');
                        stayDisplayContainer.className = 'stay-display-container';
                        stayDisplayContainer.setAttribute('id', `${destination}-stay-display`);
                        destinationContainer.appendChild(stayDisplayContainer);

                        const sortButton = document.createElement('button');
                        sortButton.className = 'sort-button';
                        sortButton.textContent = 'Sort by Price';
                        sortButton.addEventListener('click', () => sortStayOptions(destination));
                        destinationContainer.appendChild(sortButton);

                        chatContainer.appendChild(destinationContainer);

                        createDestinationSeparator(destination);
                    });

                    chatContainer.scrollTop = chatContainer.scrollHeight;
                }

                function toggleStayData(type, destination) {
                    const displayContainer = document.getElementById(`${destination}-stay-display`);
                    const currentDisplay = displayContainer.getAttribute('data-current-display');

                    if (currentDisplay === type) {
                        displayContainer.innerHTML = '';
                        displayContainer.removeAttribute('data-current-display');
                        return;
                    }

                    displayContainer.innerHTML = '';
                    displayContainer.setAttribute('data-current-display', type);
                    
                    const stayOptionsGrid = document.createElement('div');
                    stayOptionsGrid.className = 'stay-options-grid';

                    const stayOptions = stayData[destination][type];
                    stayOptions.forEach(option => {
                        const optionBox = document.createElement('div');
                        optionBox.className = 'option-box';

                        const optionImage = document.createElement('img');
                        optionImage.src = option.image;
                        optionImage.className = 'option-image';

                        const optionName = document.createElement('h4');
                        optionName.textContent = option.name;

                        const optionPrice = document.createElement('p');
                        optionPrice.textContent = `$${option.price}`;

                        const chooseButton = document.createElement('button');
                        chooseButton.textContent = 'Choose';
                        chooseButton.className = 'choose-button';
                        chooseButton.addEventListener('click', () => chooseStayOption(destination, option.name));

                        optionBox.appendChild(optionImage);
                        optionBox.appendChild(optionName);
                        optionBox.appendChild(optionPrice);
                        optionBox.appendChild(chooseButton);

                        stayOptionsGrid.appendChild(optionBox);
                        
                    });
                    displayContainer.appendChild(stayOptionsGrid);
                }

                let sortOrder = 'ascending'; // Keep track of the current sort order

                function sortStayOptions(destination) {
                    const displayContainer = document.getElementById(`${destination}-stay-display`);
                    const currentDisplay = displayContainer.getAttribute('data-current-display');

                    if (!currentDisplay) return;

                    // Clone the current stay options to avoid modifying the original data
                    const stayOptions = stayData[destination][currentDisplay].slice();

                    // Toggle sorting order
                    if (sortOrder === 'ascending') {
                        stayOptions.sort((a, b) => a.price - b.price);
                        sortOrder = 'descending'; // Switch to descending for next click
                    } else {
                        stayOptions.sort((a, b) => b.price - a.price);
                        sortOrder = 'ascending'; // Switch back to ascending for next click
                    }

                    // Clear the current display
                    displayContainer.innerHTML = '';

                    // Create a grid container
                    const stayOptionsGrid = document.createElement('div');
                    stayOptionsGrid.className = 'stay-options-grid';

                    // Populate the grid with sorted options
                    stayOptions.forEach(option => {
                        const optionBox = document.createElement('div');
                        optionBox.className = 'option-box';

                        const optionImage = document.createElement('img');
                        optionImage.src = option.image;
                        optionImage.className = 'option-image';

                        const optionName = document.createElement('h4');
                        optionName.textContent = option.name;

                        const optionPrice = document.createElement('p');
                        optionPrice.textContent = `$${option.price}`;

                        const chooseButton = document.createElement('button');
                        chooseButton.textContent = 'Choose';
                        chooseButton.className = 'choose-button';
                        chooseButton.addEventListener('click', () => chooseStayOption(destination, option.name));

                        optionBox.appendChild(optionImage);
                        optionBox.appendChild(optionName);
                        optionBox.appendChild(optionPrice);
                        optionBox.appendChild(chooseButton);

                        stayOptionsGrid.appendChild(optionBox);
                    });

                    // Append the grid container to the display container
                    displayContainer.appendChild(stayOptionsGrid);
            }

            function chooseStayOption(destination, optionName) {
                // Find the selected option's details
                const selectedOption = Object.values(stayData[destination]).flat().find(option => option.name === optionName);
            
                // Create a chat bubble with the chosen option's details
                const chosenMessage = document.createElement('div');
                chosenMessage.className = 'message bot-message fade-in left-bubble'; // Add left-bubble class for styling
            
                // Add image, name, and price to the message bubble
                const optionImage = document.createElement('img');
                optionImage.src = selectedOption.image;
                optionImage.className = 'bubble-image'; // Add class for styling
            
                const optionDetails = document.createElement('div');
                optionDetails.className = 'bubble-details'; // Add class for styling
                optionDetails.innerHTML = `
                    <strong>${optionName} - ${destination}</strong><br>
                    Price: $${selectedOption.price}
                `;
            
                chosenMessage.appendChild(optionImage);
                chosenMessage.appendChild(optionDetails);
            
                chatContainer.appendChild(chosenMessage);
            
                // Disable all stay option buttons for this destination
                const destinationContainer = document.querySelector(`#${destination}-stay-display`).parentElement;
                const buttons = destinationContainer.querySelectorAll('.stay-option-button');
                buttons.forEach(button => button.disabled = true);
            
                // Hide the entire destination container after selection
                destinationContainer.style.display = 'none';
            
                // Send the chosen option to the Django backend
                const postData = {
                    destination: destination,
                    optionName: optionName,
                    price: selectedOption.price,
                };
                
                console.log('Initiating POST request to /choose-stay/ with data:', postData);
                setTimeout(() => {
                    fetch('/choose-stay/', { // Replace with your Django endpoint
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': getCookie('csrftoken') // Include CSRF token for security
                        },
                        body: JSON.stringify(postData)
                    })
                    .then(response => {
                        if (response.ok) {
                            return response.json();
                        } else {
                            throw new Error('Network response was not ok');
                        }
                    })
                    .then(data => {
                        if (data.success) {
                            console.log('Stay chosen:', postData.optionName);

                            // Create and show the "Get Itinerary" button
                            const getItineraryButton = document.createElement('button');
                            getItineraryButton.className = 'get-itinerary-button';
                            getItineraryButton.textContent = 'Get Itinerary';
                            getItineraryButton.addEventListener('click', () => {
                                window.location.href = '/finalize-itinerary/';
                            });

                            // Append button to the chat container and make it appear smoothly
                            chatContainer.appendChild(getItineraryButton);

                            // Delay adding the 'show' class for smooth animation
                            setTimeout(() => {
                                getItineraryButton.classList.add('show');
                            }, 100); // Delay to allow CSS transition to take effect

                            chatContainer.scrollTop = chatContainer.scrollHeight;
                        } else {
                            console.error('Error:', data.message);
                        }
                    })
                }, 2000);  // Delay for 2 seconds
            }

            // Helper function to get CSRF token
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
        });        
    </script>
</body>
</html>
